# Maintenance Reports

This directory contains automated maintenance reports generated by the monthly maintenance script.

## Overview

The automated maintenance system identifies deprecated files based on:
- **File naming patterns**: AUDIT, DIAGNOSTIC, FIX, REPORT, etc.
- **Last modified date**: Files not modified in 90+ days
- **Git commit history**: Analysis of last commits and changes

## Reports

- **deprecated-files-YYYY-MM-DD.md**: Monthly scan reports
- **deletion-log.md**: Historical log of all deleted files

## Usage

### Generate a Report

```bash
bash scripts/automated-maintenance.sh
```

### Approve Deletion

After reviewing the report:

```bash
bash scripts/automated-maintenance.sh --approve
```

You will be prompted to type `DELETE` to confirm.

## Protected Files

The following patterns are **never** flagged for deletion:
- Production configuration files
- Source code (`src/**/*`)
- Supabase functions (`supabase/**/*`)
- GitHub workflows (`.github/**/*`)
- Package manifests (`package.json`, `package-lock.json`)
- Build configurations (`vite.config.ts`, `tsconfig*.json`)
- Environment files (`.env*`)

See `scripts/maintenance-config.json` for the complete list.

## Automated Workflow

The maintenance script runs automatically on the 1st of every month via GitHub Actions:
- Generates a report
- Creates a GitHub issue with findings
- Uploads report as an artifact
- Requires manual approval for deletion

## Manual Trigger

You can manually trigger the workflow from GitHub Actions:
1. Go to Actions tab
2. Select "Monthly Repository Maintenance"
3. Click "Run workflow"

## Safety Features

1. **Protected patterns**: Critical files are never flagged
2. **Manual approval**: Requires explicit confirmation before deletion
3. **Deletion log**: All deletions are logged with timestamps
4. **Git history**: Preserves commit history for rollback
5. **Dry run by default**: Only generates reports unless `--approve` is used

## Rollback

If files are accidentally deleted:

```bash
# View deletion log
cat maintenance-reports/deletion-log.md

# Restore from git history
git checkout HEAD~1 -- path/to/deleted/file.md
```

## Configuration

Edit `scripts/maintenance-config.json` to customize:
- Days threshold (default: 90)
- Deprecated patterns
- Protected patterns
- Critical files list
